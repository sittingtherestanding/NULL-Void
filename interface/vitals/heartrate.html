var displayHeartRate = function(width, height)
{
    var beatIndex = 0

    var x = 0
    var initY = canvas.height / 2
    var y = initY

    var past = new Date()

    var beat = [0, 0, -14, -28, -14, 0, 18, 36, 18, 0, -25, -50, -25, 0, 25, 50, 25, 0, 0]
    var history = new Array()

    var drawWave = function()
    {
        var present = new Date()

        if (present.getTime() - past.getTime() > 1000 * 60 / bpm)
        {
            beatIndex = 1 // Start the beat

            past = new Date()
        }

        if (beatIndex > 0 && beatIndex < beat.length - 1)
        {
            beatIndex++
        }
        else
        {
            beatIndex = 0 // Stop the beat
        }

        if (history.length >= 200)
        {
            history.push(initY + beat[beatIndex])

            x = 0
            ctx.clearRect(0, 0, canvas.width, canvas.height)

            for (var j = history.length - 200; j < history.length; j++)
            {
                ctx.beginPath()
                ctx.moveTo(x - 1, history[j - 1])
                ctx.lineTo(x, history[j])
                ctx.stroke()

                x++
            }
        }
        else
        {
            ctx.beginPath()

            if (beatIndex > 0)
            {
                history.push(initY + beat[beatIndex])

                ctx.moveTo(x - 1, initY + beat[beatIndex - 1])
                ctx.lineTo(x, initY + beat[beatIndex])
            }
            else
            {
                history.push(initY)

                ctx.moveTo(x - 1, initY)
                ctx.lineTo(x, initY)
            }
            
            ctx.stroke()

            x++   
        }

        requestAnimationFrame(drawWave)
    }
}