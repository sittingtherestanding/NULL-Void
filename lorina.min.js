var Accelerometer=function(){this.z=this.y=this.x=0;document.addEventListener("deviceorientation",function(a){this.x=a.beta;this.y=a.alpha;this.z=a.gamma},!0)};var Camera=function(){this.reset=function(){l.camera.x=0;l.camera.y=0;return this};this.setSandbox=function(a,b){l.camera.sandbox.width=a;l.camera.sandbox.height=b;0>=l.camera.sandbox.width&&(l.camera.sandbox.width=1);0>=l.camera.sandbox.height&&(l.camera.sandbox.height=1);return this};this.follow=function(a,b){if(!a.deleted){if(b&&!b.deleted)var c=a.x<b.x?(b.x-a.x)/2+a.x:(a.x-b.x)/2+b.x,d=a.y<b.y?(b.y-a.y)/2+a.y:(a.y-b.y)/2+b.y;else c=a.x,d=a.y;"resting"==l.camera.state&&(l.camera.sandbox.width&&
(c<l.camera.x+l.dom.width/2-l.camera.sandbox.width/2?l.camera.x=c-l.dom.width/2+l.camera.sandbox.width/2:c>l.camera.x+l.dom.width/2+l.camera.sandbox.width/2&&(l.camera.x=c-l.dom.width/2-l.camera.sandbox.width/2)),l.camera.sandbox.height&&(d<l.camera.y+l.dom.height/2-l.camera.sandbox.height/2?l.camera.y=d-l.dom.height/2+l.camera.sandbox.height/2:d>l.camera.y+l.dom.height/2+l.camera.sandbox.height/2&&(l.camera.y=d-l.dom.height/2-l.camera.sandbox.height/2)),0>l.camera.x?l.camera.x=0:l.camera.x>l.room.width-
l.dom.width&&(l.camera.x=l.room.width-l.dom.width),0>l.camera.y?l.camera.y=0:l.camera.y>l.room.height-l.dom.height&&(l.camera.y=l.room.height-l.dom.height))}return this};this.focusOn=function(a,b){if(b&&!b.deleted)var c=a.x<b.x?(b.x-a.x)/2+a.x:(a.x-b.x)/2+b.x,d=a.y<b.y?(b.y-a.y)/2+a.y:(a.y-b.y)/2+b.y;else c=a.x,d=a.y;l.camera.x=c-l.dom.width/2;l.camera.y=d-l.dom.height/2;l.mouse&&l.mouse.calculate();return this};this.shake=function(a,b,c){"resting"==l.camera.state&&(l.camera.previous.x=l.camera.x,
l.camera.previous.y=l.camera.y);l.camera.state="shaking";c/=2*a;for(var d=0;d<2*a;d++)this.milkshake(d,c,b);return this};this.milkshake=function(a,b,c){setTimeout(function(){l.camera.state="shaking";var a=0-c/2,b=c/2,f=Math.random()*(b-a)+a,a=Math.random()*(b-a)+a;l.camera.x=0<f?l.camera.x+f:l.camera.x-Math.abs(f);l.camera.y=0<a?l.camera.y+a:l.camera.y-Math.abs(a)},a*b);setTimeout(function(){l.camera.state="resting";l.camera.x=l.camera.previous.x;l.camera.y=l.camera.previous.y},a*b+b/2)}};var Cartographer=function(){this.loadMap=function(a){a.tileset.img=new Image;a.tileset.img.onload=function(){a.tileset.width=this.width;a.tileset.height=this.height};a.tileset.img.src=a.tileset.image;return this};this.drawMap=function(a){for(var b=a.layout.tiles.length/a.layout.width;b--;)for(var c=a.layout.width;c--;)0<a.layout.tiles[b*a.layout.width+c]&&l.ctx.drawImage(a.tileset.img,a.tileset.width/a.tileset.count*(a.layout.tiles[b*a.layout.width+c]-1),0,a.tileset.width/a.tileset.count,a.tileset.height,
a.tileset.width/a.tileset.count*c-l.camera.x,b*a.tileset.height-l.camera.y,a.tileset.width/a.tileset.count,a.tileset.height);return this};this.populateMap=function(a){return this}};var Clipper=function(){this.mark=function(a,b,c,d){l.ctx.save();l.ctx.beginPath();l.ctx.rect(a,b,c,d);l.ctx.clip();return this};this.clip=function(){l.ctx.restore();return this}};var Entity=function(){this.y=this.x=0;this.difference={x:0,y:0};this.degree=this.height=this.width=0;this.anchor={x:0,y:0};this.bound={x:0,y:0,width:0,height:0};this.sprite={img:new Image};this.debug=function(a){this.deleted||(l.ctx.fillStyle=a?a:"#FF0000",l.ctx.globalAlpha=.5,l.ctx.fillRect(this.x+this.bound.x-l.camera.x,this.y+this.bound.y-l.camera.y,this.bound.width,this.bound.height),l.ctx.fillRect(this.x-2-l.camera.x,this.y-2-l.camera.y,5,5),l.ctx.globalAlpha=1);return this};this["delete"]=function(){this.deleted=
!0;return this};this.setPosition=function(a,b){this.x=a;this.y=b;return this};this.recordDifference=function(a,b){"horizontal"==a?this.difference.x=b:"vertical"==a&&(this.difference.y=b);return this};this.setAnchor=function(a,b){this.anchor={x:a,y:b};this.width&&this.height&&this.setBound(0-this.anchor.x,0-this.anchor.y,this.width,this.height);return this};this.setSize=function(a,b,c){this.width=a;this.height=b;c&&this.setBound(this.x,this.y,this.width,this.height);return this};this.setStretch=function(a,
b){this.stretch={width:a,height:b};return this};this.setBound=function(a,b,c,d){this.bound={x:a,y:b,width:c,height:d};return this};this.rotate=function(a){this.degree+=a;this.fixRotation();return this};this.rotateTo=function(a){this.degree=a;this.fixRotation();return this};this.fixRotation=function(){0>this.degree?this.degree+=360:360<this.degree&&(this.degree-=360);return this};this.steer=function(){this.degree=180*-Math.atan(this.difference.y/this.difference.x)/Math.PI;0>this.difference.x&&(this.degree+=
180);return this};this.setSprite=function(a,b,c){var d=this;this.sprite.img.onload=function(){d.sprite.width=this.width;d.sprite.height=this.height;b&&d.setSize(this.width,this.height);c&&d.setBound(0,0,this.width,this.height)};this.sprite.img.src=a;return this};this.setAnimation=function(a,b){this.sprite.frame=0;this.sprite.count=a;this.sprite.timer=Math.round(b);var c=this;this.animation=setInterval(function(){c.sprite.frame=c.sprite.frame<c.sprite.count-1?c.sprite.frame+1:0},c.sprite.timer);return this};
this.pauseAnimation=function(){this.sprite.animation&&clearInterval(this.sprite.animation);return this};this.setOpacity=function(a){this.opacity=a;return this};this.fadeOut=function(a){this.opacity=0<this.opacity?this.opacity-a:0;return this};this.fadeIn=function(a){this.opacity=1>this.opacity?this.opacity+a:1;return this};this.buffer=function(){this.deleted||l.buffer.push(this);return this};this.flip=function(a){this.flipped=a;return this};this.unflip=function(a){"horizontal"==this.flipped?"both"==
this.flipped?this.flipped="vertical":delete this.flipped:"vertical"==this.flipped?"both"==this.flipped?this.flipped="vertical":delete this.flipped:"both"==this.flipped&&delete this.flipped;return this};this.hud=function(){this.drawMode="hud";return this};this.draw=function(){"hud"==this.drawMode?this.cameraY=this.cameraX=0:(this.cameraX=l.camera.x,this.cameraY=l.camera.y);this.deleted||(this.opacity&&(l.ctx.globalAlpha=this.opacity),this.flipped||this.degree?(l.ctx.save(),"undefined"!==this.flipped&&
("horizontal"==this.flipped?(l.ctx.translate(Math.round(this.x+this.width-2*this.anchor.x-this.cameraX),Math.round(this.y-this.cameraY)),l.ctx.scale(-1,1)):"vertical"==this.flipped?(l.ctx.translate(Math.round(this.x-this.cameraX),Math.round(this.y+this.height-2*this.anchor.y-this.cameraY)),l.ctx.scale(1,-1)):"both"==this.flipped&&(l.ctx.translate(Math.round(this.x+this.width-2*this.anchor.x-this.cameraX),Math.round(this.y+this.height-2*this.anchor.y-this.cameraY)),l.ctx.scale(-1,-1))),this.degree&&
(l.ctx.translate(Math.round(this.x-this.cameraX),Math.round(this.y-this.cameraY)),l.ctx.rotate(this.degree*Math.PI/180*-1)),this.stretch?this.sprite.count?l.ctx.drawImage(this.sprite.img,this.sprite.width/this.sprite.count*this.sprite.frame,0,this.sprite.width/this.sprite.count,this.sprite.height,Math.round(0-this.anchor.x),Math.round(0-this.anchor.y),this.sprite.width/this.sprite.count,this.sprite.height,this.stretch.width,this.stretch.height):l.ctx.drawImage(this.sprite.img,Math.round(0-this.anchor.x),
Math.round(0-this.anchor.y),this.stretch.width,this.stretch.height):this.sprite.count?l.ctx.drawImage(this.sprite.img,this.sprite.width/this.sprite.count*this.sprite.frame,0,this.sprite.width/this.sprite.count,this.sprite.height,Math.round(0-this.anchor.x),Math.round(0-this.anchor.y),this.sprite.width/this.sprite.count,this.sprite.height):l.ctx.drawImage(this.sprite.img,Math.round(0-this.anchor.x),Math.round(0-this.anchor.y)),l.ctx.restore()):this.stretch?this.sprite.count?l.ctx.drawImage(this.sprite.img,
this.sprite.width/this.sprite.count*this.sprite.frame,0,this.sprite.width/this.sprite.count,this.sprite.height,Math.round(this.x-this.anchor.x-this.cameraX),Math.round(this.y-this.anchor.y-this.cameraY),this.sprite.width/this.sprite.count,this.sprite.height,this.stretch.width,this.stretch.height):l.ctx.drawImage(this.sprite.img,Math.round(this.x-this.anchor.x-this.cameraX),Math.round(this.y-this.anchor.y-this.cameraY),this.stretch.width,this.stretch.height):this.sprite.count?l.ctx.drawImage(this.sprite.img,
this.sprite.width/this.sprite.count*this.sprite.frame,0,this.sprite.width/this.sprite.count,this.sprite.height,Math.round(this.x-this.anchor.x-this.cameraX),Math.round(this.y-this.anchor.y-this.cameraY),this.sprite.width/this.sprite.count,this.sprite.height):l.ctx.drawImage(this.sprite.img,Math.round(this.x-this.anchor.x-this.cameraX),Math.round(this.y-this.anchor.y-this.cameraY)));this.opacity&&(l.ctx.globalAlpha=1);return this};this.snapTo=function(a,b){this.x=a;this.y=b;return this};this.moveHorizontal=
function(a){this.recordDifference("horizontal",a);this.x+=a;return this};this.moveVertical=function(a){this.recordDifference("vertical",a);this.y+=a;return this};this.moveTo=function(a,b,c){a-=this.x;var d=b-this.y;b=Math.sqrt(a*a+d*d);d=d/b*c;1<b&&(this.moveHorizontal(a/b*c),this.moveVertical(d));return this};this.moveToward=function(a,b){if(!a.deleted){var c=a.x-this.x,d=a.y-this.y,e=Math.sqrt(c*c+d*d),d=d/e*b;1<e&&(this.moveHorizontal(c/e*b),this.moveVertical(d))}return this};this.moveTowardDegree=
function(a,b){this.moveHorizontal(Math.cos(a*Math.PI/180)*b);this.moveVertical(-Math.sin(a*Math.PI/180)*b);return this};this.contain=function(a,b,c,d){a||b||c||d||(a=0,b=l.room.width,c=0,d=l.room.height);this.x+this.bound.x<=a?this.x=a-this.bound.x:this.x+this.bound.x+this.bound.width>=b&&(this.x=b-this.bound.width-this.bound.x);this.y+this.bound.y<=c?this.y=c-this.bound.y:this.y+this.bound.y+this.bound.height>=d&&(this.y=d-this.bound.height-this.bound.y);return this};this.setFriction=function(a,
b){this.friction=b?{x:0,y:0,movement:a,rotation:b}:{x:0,y:0,movement:a,rotation:a};this.momentum={x:0,y:0,rotation:0};return this};this.freeze=function(){this.momentum={x:0,y:0,rotation:0};return this};this.spin=function(a){this.momentum.rotation=a;return this};this.pushTowardDegree=function(a,b){this.momentum.x=Math.cos(a*Math.PI/180)*b;this.momentum.y=-Math.sin(a*Math.PI/180)*b;return this};this.pushHorizontal=function(a){this.momentum.x+=a;return this};this.pushVertical=function(a){this.momentum.y+=
a;return this};this.scatter=function(a){this.momentum.x=Math.random()*(a- -1*a)+-1*a;this.momentum.y=Math.random()*(a- -1*a)+-1*a;return this};this.pullTo=function(a,b,c){a-=this.x;var d=b-this.y;b=Math.sqrt(a*a+d*d);d=d/b*c;1<b&&(this.pushHorizontal(a/b*c),this.pushVertical(d));return this};this.pullToward=function(a,b){if(!a.deleted){var c=a.x-this.x,d=a.y-this.y,e=Math.sqrt(c*c+d*d),d=d/e*b;1<e&&(this.pushHorizontal(c/e*b),this.pushVertical(d))}return this};this.bounce=function(a,b,c,d){a||b||
c||d||(a=0,b=l.room.width,c=0,d=l.room.height);this.x+this.bound.x<=a?(this.x=a-this.bound.x,this.momentum.x=-this.momentum.x):this.x+this.bound.x+this.bound.width>=b&&(this.x=b-this.bound.width-this.bound.x,this.momentum.x=-this.momentum.x);this.y+this.bound.y<=c?(this.y=c-this.bound.y,this.momentum.y=-this.momentum.y):this.y+this.bound.y+this.bound.height>=d&&(this.y=d-this.bound.height-this.bound.y,this.momentum.y=-this.momentum.y);return this};this.applyPhysics=function(){this.momentum.x&&this.momentum.y&&
(Math.abs(this.momentum.x)>Math.abs(this.momentum.y)?(this.friction.x=this.friction.movement,this.friction.y=Math.abs(this.momentum.y/this.momentum.x*this.friction.movement)):(this.friction.x=Math.abs(this.momentum.x/this.momentum.y*this.friction.movement),this.friction.y=this.friction.movement));0!==this.momentum.x&&(this.moveHorizontal(this.momentum.x),0>this.momentum.x?(this.momentum.x+=this.friction.x,0<this.momentum.x&&(this.momentum.x=0)):0<this.momentum.x&&(this.momentum.x-=this.friction.x,
0>this.momentum.x&&(this.momentum.x=0)));0!==this.momentum.y&&(this.moveVertical(this.momentum.y),0>this.momentum.y?(this.momentum.y+=this.friction.y,0<this.momentum.y&&(this.momentum.y=0)):0<this.momentum.y&&(this.momentum.y-=this.friction.y,0>this.momentum.y&&(this.momentum.y=0)));0!==this.momentum.rotation&&(this.degree+=this.momentum.rotation,0>this.momentum.rotation?(this.momentum.rotation+=this.friction.rotation,0<this.momentum.rotation&&(this.momentum.rotation=0)):0<this.momentum.rotation&&
(this.momentum.rotation-=this.friction.rotation,0>this.momentum.rotation&&(this.momentum.rotation=0)));return this}};var Finger=function(){this.database=[];var a=this;document.touchstart=function(b){a.touches(b)};document.touchmove=function(b){a.touches(b)};document.touchend=function(b){a.touches(b)};document.touchcancel=function(b){a.touches(b)};this.touches=function(a){a?this.database=a.touches:this.database.length=0};this.checkTouched=function(a){if(0<this.database.length)for(var c=this.database.length;c--;){if(this.database[c].pageX<a.bound.x+a.bound.width&&this.database[c].pageX>a.bound.x&&this.database[c].pageY<
a.bound.y+a.bound.height&&this.database[c].pageY>a.bound.y)return!0;if(c==this.database.length-1)return!1}}};var GameCenter=function(){this.authed=!1;this.socket=new Ejecta.GameCenter;this.softLogin=function(){this.socket.softAuthenticate()};this.hardLogin=function(){this.socket.authenticate()};this.submitScore=function(a,b){this.socket.reportScore(a,b)};this.showLeaderboard=function(a){this.socket.showLeaderboard(a)}};var Gamepad=function(){this.deadzone=0;this.update=function(){l.gamepads=navigator.webkitGetGamepads();var a=l.gamepads[0];a&&(this.p1={buttons:{playstation:a.buttons[16],x:a.buttons[0],circle:a.buttons[1],square:a.buttons[2],triangle:a.buttons[3],l1:a.buttons[4],l2:a.buttons[6],r1:a.buttons[5],r2:a.buttons[7],select:a.buttons[8],start:a.buttons[9],up:a.buttons[12],down:a.buttons[13]},left:a.buttons[14],right:a.buttons[15],joysticks:{left:{horizontal:a.axes[0],vertical:a.axes[1],button:a.buttons[10]},
right:{horizontal:a.axes[2],vertical:a.axes[3],button:a.buttons[11]}}});if(a=l.gamepads[1])this.p2={buttons:{playstation:a.buttons[16],x:a.buttons[0],circle:a.buttons[1],square:a.buttons[2],triangle:a.buttons[3],l1:a.buttons[4],l2:a.buttons[6],r1:a.buttons[5],r2:a.buttons[7],select:a.buttons[8],start:a.buttons[9],up:a.buttons[12],down:a.buttons[13]},left:a.buttons[14],right:a.buttons[15],joysticks:{left:{horizontal:a.axes[0],vertical:a.axes[1],button:a.buttons[10]},right:{horizontal:a.axes[2],vertical:a.axes[3],
button:a.buttons[11]}}};this.applyDeadzone();return this};this.setDeadzone=function(a){this.deadzone=a;return this};this.applyDeadzone=function(){0<this.deadzone&&(this.p1&&(Math.abs(gamepads.p1.joysticks.left.horizontal)<this.deadzone&&(gamepads.p1.joysticks.left.horizontal=0),Math.abs(gamepads.p1.joysticks.left.vertical)<this.deadzone&&(gamepads.p1.joysticks.left.vertical=0),Math.abs(gamepads.p1.joysticks.right.horizontal)<this.deadzone&&(gamepads.p1.joysticks.right.horizontal=0),Math.abs(gamepads.p1.joysticks.right.vertical)<
this.deadzone&&(gamepads.p1.joysticks.right.vertical=0)),this.p2&&(Math.abs(gamepads.p2.joysticks.left.horizontal)<this.deadzone&&(gamepads.p2.joysticks.left.horizontal=0),Math.abs(gamepads.p2.joysticks.left.vertical)<this.deadzone&&(gamepads.p2.joysticks.left.vertical=0),Math.abs(gamepads.p2.joysticks.right.horizontal)<this.deadzone&&(gamepads.p2.joysticks.right.horizontal=0),Math.abs(gamepads.p2.joysticks.right.vertical)<this.deadzone&&(gamepads.p2.joysticks.right.vertical=0)))}};var Group=function(){this.database=[];this.add=function(a){this.database.push(a)};this.remove=function(a){for(var b=this.database.length;b--;)if(this.database[b]==a){this.database.splice(b,1);break}};this.debug=function(a){for(var b=this.database.length;b--;)this.database[b].debug(a);return this};this["delete"]=function(){for(var a=this.database.length;a--;)this.database[a]["delete"]();return this};this.setPosition=function(a,b){for(var c=this.database.length;c--;)this.database[c].setPosition(a,b);
return this};this.setSize=function(a,b){for(var c=this.database.length;c--;)this.database[c].setSize(a,b);return this};this.setAnchor=function(a,b){for(var c=this.database.length;c--;)this.database[c].setAnchor(a,b);return this};this.setBound=function(a,b,c,d){for(var e=this.database.length;e--;)this.database[e].setbound(a,b,c,d);return this};this.rotate=function(a){for(var b=this.database.length;b--;)this.database[b].rotate(a);return this};this.rotateTo=function(a){for(var b=this.database.length;b--;)this.database[b].rotateTo(a);
return this};this.steer=function(){for(var a=this.database.length;a--;)this.database[a].steer();return this};this.setSprite=function(a){for(var b=this.database.length;b--;)this.database[b].setSprite(a);return this};this.setAnimation=function(a,b){for(var c=this.database.length;c--;)this.database[c].setAnimation(a,b);return this};this.pauseAnimation=function(){for(var a=this.database.length;a--;)this.database[a].pauseAnimation();return this};this.buffer=function(){for(var a=this.database.length;a--;)this.database[a].buffer();
return this};this.flip=function(a){for(var b=this.database.length;b--;)this.database[b].flip(a);return this};this.hud=function(){for(var a=this.database.length;a--;)this.database[a].hud();return this};this.draw=function(){for(var a=this.database.length;a--;)this.database[a].draw();return this};this.snapTo=function(a,b){for(var c=this.database.length;c--;)this.database[c].snapTo(a,b);return this};this.moveHorizontal=function(a){for(var b=this.database.length;b--;)this.database[b].moveHorizontal(a);
return this};this.moveVertical=function(a){for(var b=this.database.length;b--;)this.database[b].moveVertical(a);return this};this.moveTo=function(a,b,c){for(var d=this.database.length;d--;)this.database[d].moveTo(a,b,c);return this};this.moveToward=function(a,b){for(var c=this.database.length;c--;)this.database[c].moveToward(a,b);return this};this.moveTowardDegree=function(a,b){for(var c=this.database.length;c--;)this.database[c].moveTowardDegree(a,b);return this};this.contain=function(a,b,c,d){for(var e=
this.database.length;e--;)this.database[e].contain(a,b,c,d);return this};this.setFriction=function(a){for(var b=this.database.length;b--;)this.database[b].setFriction(a);return this};this.freeze=function(){for(var a=this.database.length;a--;)this.database[a].freeze();return this};this.spin=function(a){for(var b=this.database.length;b--;)this.database[b].spin(a);return this};this.pushHorizontal=function(a){for(var b=this.database.length;b--;)this.database[b].pushHorizontal(a);return this};this.pushVertical=
function(a){for(var b=this.database.length;b--;)this.database[b].pushVertical(a);return this};this.scatter=function(a){for(var b=this.database.length;b--;)this.database[b].scatter(a);return this};this.pullTo=function(a,b,c){for(var d=this.database.length;d--;)this.database[d].pullTo(a,b,c);return this};this.pullToward=function(a,b){for(var c=this.database.length;c--;)this.database[c].pullToward(a,b);return this};this.bounce=function(a,b,c,d){for(var e=this.database.length;e--;)this.database[e].bounce(a,
b,c,d);return this};this.applyPhysics=function(){for(var a=this.database.length;a--;)this.database[a].applyPhysics();return this}};var Keyboard=function(){var a=this;window.onkeydown=function(){a.pressed(event)};window.onkeyup=function(){a.cancel(event)};this.pressed=function(a){27==a.keyCode&&(this.escape=!0);32==a.keyCode&&(this.space=!0);13==a.keyCode&&(this.enter=!0);16==a.keyCode&&(this.shift=!0);87==a.keyCode&&(this.w=!0);65==a.keyCode&&(this.a=!0);83==a.keyCode&&(this.s=!0);68==a.keyCode&&(this.d=!0);38==a.keyCode&&(this.up=!0);40==a.keyCode&&(this.down=!0);37==a.keyCode&&(this.left=!0);39==a.keyCode&&(this.right=!0)};
this.cancel=function(a){27==a.keyCode&&(this.escape=!1);32==a.keyCode&&(this.space=!1);13==a.keyCode&&(this.enter=!1);16==a.keyCode&&(this.shift=!1);87==a.keyCode&&(this.w=!1);65==a.keyCode&&(this.a=!1);83==a.keyCode&&(this.s=!1);68==a.keyCode&&(this.d=!1);38==a.keyCode&&(this.up=!1);40==a.keyCode&&(this.down=!1);37==a.keyCode&&(this.left=!1);39==a.keyCode&&(this.right=!1)}};var l={},Lorina=function(){l.dom=document.getElementById("canvas");l.ctx=document.getElementById("canvas").getContext("2d");l.room={};l.buffer=[];l.camera={state:"resting",x:0,y:0,previous:{x:0,y:0},sandbox:{width:1,height:1}};this.setRoomSize=function(a,b){l.room.width=a;l.room.height=b;return this};this.setDomSize=function(a,b){l.dom.width=a;l.dom.height=b;return this};this.setDomPosition=function(a,b){l.dom.style.left=a+"px";l.dom.style.top=b+"px";return this};window.navigator.vendor?(this.setRoomSize(256,
224),this.setDomSize(l.room.width,l.room.height)):this.setRoomSize(l.dom.width,l.dom.height);this.setTitle=function(a){document.title=a;return this};this.scale=function(a){l.ctx.imageSmoothingEnabled=!1;l.ctx.scale(a/100,a/100);return this};this.makeFullscreen=function(){document.body.style.background=this.color;var a=this;window.onresize=function(){a.setFullscreen()};this.setFullscreen();l.room.width=l.dom.width;l.room.height=l.dom.height;return this};this.setFullscreen=function(){l.dom.style.position=
"absolute";l.dom.style.left="0px";l.dom.style.top="0px";l.dom.width=window.innerWidth;l.dom.height=window.innerHeight;this.stretch&&(l.room.width=l.dom.width,l.room.height=l.dom.height);return this};this.makeRoomFullscreen=function(){this.stretch=!0;return this};this.hideCursor=function(){l.dom.style.cursor="none";return this};this.start=function(a){this.setRoom(a);return this};this.stop=function(){clearInterval(this.loop);return this};this.setRoom=function(a){l.room.current=a;window.requestAnimationFrame(a);
return this};this.setColor=function(a){this.color=a;return this};this.blank=function(a){l.ctx.fillStyle=a?a:this.color;l.ctx.fillRect(0,0,l.dom.width,l.dom.height);l.buffer.length=0;return this};this.draw=function(){l.buffer.sort(function(a,c){return a.y-c.y});for(var a=l.buffer.length;a--;)l.buffer[a].draw();window.requestAnimationFrame(l.room.current);return this};this.checkSolid=function(a,b){var c=this.checkCollision(a,b);c&&(a.previous.y+a.bound.y+a.bound.height<=c.y+c.bound.y?a.y=c.y+c.bound.y-
(a.bound.height+a.bound.y):a.previous.y+a.bound.y>=c.y+c.bound.y+c.bound.height?a.y=c.y+c.bound.y+c.bound.height-a.bound.y:a.previous.x+a.bound.x+a.bound.width<c.x?a.x=c.x+c.bound.x-(a.bound.width+a.bound.x):a.previous.x+a.bound.x>c.x&&(a.x=c.x+c.bound.x+c.bound.width-a.bound.x));return this};this.checkCollision=function(a,b){if(a.deleted)return!1;if(b.database){for(var c=b.database.length;c--;)if(!b.database[c].deleted&&a.x+a.bound.x<b.database[c].x+b.database[c].bound.x+b.database[c].bound.width&&
a.x+a.bound.x+a.bound.width>b.database[c].x+b.database[c].bound.x&&a.y+a.bound.y<b.database[c].y+b.database[c].bound.y+b.database[c].bound.height&&a.y+a.bound.y+a.bound.height>b.database[c].y+b.database[c].bound.y)return b.database[c];return!1}return a.x+a.bound.x<b.x+b.bound.x+b.bound.width&&a.x+a.bound.x+a.bound.width>b.x+b.bound.x&&a.y+a.bound.y<b.y+b.bound.y+b.bound.height&&a.y+a.bound.y+a.bound.height>b.y+b.bound.y?b:!1}};var Mouse=function(){var a=this;document.onmouseout=function(){a.mouseOut()};document.onmousemove=function(){a.update()};l.dom.onmousedown=function(){a.clicked()};l.dom.oncontextmenu=function(){event.preventDefault()};l.dom.onmouseup=function(){a.cancel()};this.update=function(){this.actualX=event.clientX-l.dom.offsetLeft;this.actualY=event.clientY-l.dom.offsetTop;this.calculate()};this.calculate=function(){this.x=this.actualX+l.camera.x;this.y=this.actualY+l.camera.y};this.mouseOut=function(){this.y=
this.x=null};this.clicked=function(){1==event.which?this.leftClick=!0:2==event.which?this.middleClick=!0:3==event.which&&(this.rightClick=!0,event.preventDefault())};this.checkLeftClicked=function(a){return this.leftClick&&this.x<a.x+a.bound.x+a.bound.width&&this.x>a.x+a.bound.x&&this.y<a.y+a.bound.y+a.bound.height&&this.y>a.y+a.bound.y?!0:!1};var b=void 0,c=void 0,d=!1;this.checkDrag=function(a){this.checkLeftClicked(a)?d=!0:mouse.leftClick||(c=b=void 0,d=!1);d&&(b&&c&&(a.x=mouse.x-b,a.y=mouse.y-
c),b||c||(b=mouse.x-a.x,c=mouse.y-a.y));return this};this.checkMiddleClicked=function(a){return this.middleClick&&this.x<a.x+a.bound.x+a.bound.width&&this.x>a.x+a.bound.x&&this.y<a.y+a.bound.y+a.bound.height&&this.y>a.y+a.bound.y?!0:!1};this.checkRightClicked=function(a){return this.rightClick&&this.x<a.x+a.bound.x+a.bound.width&&this.x>a.x+a.bound.x&&this.y<a.y+a.bound.y+a.bound.height&&this.y>a.y+a.bound.y?!0:!1};this.cancel=function(){1==event.which?this.leftClick=!1:2==event.which?this.middleClick=
!1:3==event.which&&(this.rightClick=!1,event.preventDefault())}};var Pencil=function(){this.setPosition=function(a,b){this.x=a;this.y=b;return this};this.setEndPosition=function(a,b){this.endX=a;this.endY=b;return this};this.setSize=function(a,b){this.width=a;this.height=b;return this};this.setRadius=function(a){this.radius=a;return this};this.setColor=function(a){this.color=a;return this};this.setOpacity=function(a){this.opacity=a;return this};this.setStroke=function(a){this.stroke=a;return this};this.setArc=function(a,b){this.start=a;this.stop=b;return this};
this.strokeLine=function(){l.ctx.strokeStyle=this.color;l.ctx.lineWidth=this.stroke;l.ctx.beginPath();l.ctx.moveTo(Math.round(this.x)+.5,Math.round(this.y)+.5);l.ctx.lineTo(Math.round(this.endX)+.5,Math.round(this.endY)+.5);this.opacity&&(l.ctx.globalAlpha=this.opacity);l.ctx.stroke();this.opacity=1;l.ctx.globalAlpha=1;return this};this.strokeCircle=function(){l.ctx.strokeStyle=this.color;l.ctx.lineWidth=this.stroke;l.ctx.beginPath();l.ctx.arc(Math.round(this.x),Math.round(this.y),this.radius,0,2*
Math.PI);this.opacity&&(l.ctx.globalAlpha=this.opacity);l.ctx.stroke();this.opacity=1;l.ctx.globalAlpha=1;return this};this.fillCircle=function(){l.ctx.fillStyle=this.color;l.ctx.beginPath();l.ctx.arc(Math.round(this.x),Math.round(this.y),this.radius,0,2*Math.PI);this.opacity&&(l.ctx.globalAlpha=this.opacity);l.ctx.fill();this.opacity=1;l.ctx.globalAlpha=1;return this};this.strokeArc=function(){l.ctx.strokeStyle=this.color;l.ctx.lineWidth=this.stroke;l.ctx.beginPath();l.ctx.arc(Math.round(this.x),
Math.round(this.y),this.radius,this.start*Math.PI/180,this.stop*Math.PI/180);this.opacity&&(l.ctx.globalAlpha=this.opacity);l.ctx.stroke();this.opacity=1;l.ctx.globalAlpha=1;return this};this.fillArc=function(){l.ctx.fillStyle=this.color;l.ctx.beginPath();l.ctx.arc(Math.round(this.x),Math.round(this.y),this.radius,this.start*Math.PI/180,this.stop*Math.PI/180);this.opacity&&(l.ctx.globalAlpha=this.opacity);l.ctx.fill();this.opacity=1;l.ctx.globalAlpha=1;return this};this.strokeRectangle=function(){l.ctx.strokeStyle=
this.color;l.ctx.lineWidth=this.stroke;l.ctx.beginPath();l.ctx.rect(Math.round(this.x),Math.round(this.y),Math.round(this.width),Math.round(this.height));this.opacity&&(l.ctx.globalAlpha=this.opacity);l.ctx.stroke();this.opacity=1;l.ctx.globalAlpha=1;return this};this.fillRectangle=function(){l.ctx.fillStyle=this.color;l.ctx.beginPath();l.ctx.rect(Math.round(this.x),Math.round(this.y),Math.round(this.width),Math.round(this.height));this.opacity&&(l.ctx.globalAlpha=this.opacity);l.ctx.fill();this.opacity=
1;l.ctx.globalAlpha=1;return this};this.fillPie=function(a){100>Math.round(a)?(a=270+3.6*a,360<a&&(a-=360),l.ctx.fillStyle=this.color,l.ctx.beginPath(),l.ctx.moveTo(Math.round(this.x),Math.round(this.y)),l.ctx.arc(Math.round(this.x),Math.round(this.y),this.radius,270*Math.PI/180,a*Math.PI/180),l.ctx.lineTo(Math.round(this.x),Math.round(this.y)),this.opacity&&(l.ctx.globalAlpha=this.opacity),l.ctx.fill(),this.opacity=1,l.ctx.globalAlpha=1):this.fillCircle();return this}};var Speaker=function(){this.file=new Audio;this.setFile=function(a){this.file.src=a;return this};this.pause=function(){this.file.pause();return this};this.play=function(){this.file.play();var a=this;this.file.onended=function(){a.file.currentTime=0};return this};this.loop=function(){this.file.loop=!0;this.file.play();return this}};var Timer=function(){this.log=function(){this.time=new Date;return this};this.check=function(a){return(new Date).getTime()-a.time.getTime()};this.compareTo=function(a){return a.time?this.time.getTime()>a.time.getTime()?this.time.getTime()-a.time.getTime():a.time.getTime()-this.time.getTime():0}};var Tool=function(){this.random=function(a,b){return Math.random()*(b-a)+a};this.measureX=function(a,b){return Math.abs(a.x-b.x)};this.measureY=function(a,b){return Math.abs(a.y-b.y)};this.measureDistance=function(a,b){var c=this.measureX(a,b),d=this.measureY(a,b);return Math.sqrt(c*c+d*d)};this.measureAngle=function(a,b){var c=b.x-a.x,d=a.y-b.y,e=180*Math.atan(d/c)/Math.PI;0>c?e+=180:0<c&&0>d&&(e+=360);return e}};var Typewriter=function(){this.setOpacity=function(a){this.opacity=a;return this};this.setStyle=function(a){this.style=a;return this};this.setFont=function(a){this.font=a;return this};this.setSize=function(a){this.size=a;return this};this.setAlignment=function(a){this.alignment=a;return this};this.setColor=function(a){this.color=a;return this};this.hud=function(){this.textMode="hud";return this};this.setPosition=function(a,b){this.x=a;this.y=b;return this};this.write=function(a){var b=this.style?
this.style:"";if(this.size){var e=this.size;this.y+=this.size}else e=10,this.y+=10;l.ctx.font=b+" "+e+"px "+(this.font?this.font:"sans-serif");l.ctx.fillStyle=this.color?this.color:"#000000";l.ctx.textAlign=this.alignment?this.alignment:"left";this.opacity&&(l.ctx.globalAlpha=this.opacity,this.opacity=1);this.print(a);l.ctx.globalAlpha=1;this.alignment="left";return this};this.print=function(a){"hud"==this.textMode?l.ctx.fillText(a,this.x,this.y):l.ctx.fillText(a,this.x-l.camera.x,this.y-l.camera.y);
this.textMode="world"};var a=!1,b=0;this.type=function(c,d){a||(this.key(c,d),a=!0);this.write(c.substr(0,b));return this};this.key=function(a,d){for(var e=0;e<a.length;e++)setTimeout(function(){b++},d*e)}};